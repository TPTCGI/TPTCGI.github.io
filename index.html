<!DOCTYPE html>
<html>
    <head><title>TPT CGI Generator</title></head>
    <body>
        <!--608 x 380-->
        <input type="number" step="0.05" onchange="draw(document.getElementById('filein'),this.value)" id="scale"/>
        <input type="file" onchange="draw(this,1);document.getElementById('scale').value = 1;" id="filein"/>
        <button onclick="generate()">Generate script [BAN WARNING]</button>
        <br>
        <textarea id="result" placeholder="Result script here"></textarea>
        <br>
        <canvas width="608" height="380" id="canvas" style="border:1px solid black"></canvas>
        <script>
            var w=0
            var h=0
            var canvas = document.getElementById("canvas").getContext("2d", {willReadFrequently: true})
            function draw(elem,s){
                console.log(s)
                let image = new Image
                image.onload = ()=>{
                    console.log(s)
                    canvas.clearRect(0,0,608,380);
                    w = image.width*s
                    h = image.height*s
                    canvas.drawImage(image,0,0,image.width*s,image.height*s)
                    URL.revokeObjectURL(image.src)
                }
                image.src = URL.createObjectURL(elem.files[0])
            }
            function generate(){
                let res = document.getElementById("result")
                let script = ""
                for (let x=0;x<w;x++){
                    for (let y=0;y<h;y++){
                        let pixel=canvas.getImageData(x,y, 1, 1, {colorSpace:"srgb"}).data
                        let color = 0xff + pixel[0]<<4 + pixel[1]<<2 + pixel[0]
                        script += `tpt.set_property("dcolor", ${color}, tpt.create(${x+4}, ${y+4}, "DMND"))\n`
                    }
                }
                res.innerText = script
            }
        </script>
    </body>
</html>
